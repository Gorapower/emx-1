// Generated by CoffeeScript 1.9.1
var app, getEsta, getUser, homeController, userController;

app = angular.module('app', []);

homeController = function(scope, window) {
  scope.login = function() {
    console.log("login");
    window.location.href = '/login';
  };
  return scope.signup = function() {
    console.log("signup");
    window.location.href = '/signup';
  };
};

userController = function(scope, window, users, estas) {
  console.log('hola');
  scope.id = 1;
  scope.disponibilidad = "#000";
  scope.ubicacion = {};
  scope.cercanos = [];
  window.navigator.geolocation.getCurrentPosition(function(position) {
    return scope.ubicacion.coory = position.coords.latitude;
  });
  window.navigator.geolocation.getCurrentPosition(function(position) {
    return scope.ubicacion.coorx = position.coords.longitude;
  });
  return scope.obtener_cercanos = function() {
    var g;
    g = 0;
    scope.initialize = function() {
      return setTimeout()(function() {
        var i, map, mapOptions, mark;
        mapOptions = {
          zoom: 15,
          center: new google.maps.LatLng(19.351416, -99.181786)
        };
        map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
        mark = new google.maps.Marker({
          position: new google.maps.LatLng(19.351416, -99.181786),
          map: map,
          title: 'Aqui estas!'
        });
        i = 0;
        while (i < g) {
          mark = new google.maps.Marker({
            position: new google.maps.LatLng(parseFloat(scope.cercanos.data[i].YCOORD, parseFloat(scope.cercanos.data[i].XCOORD))),
            map: map,
            title: 'Aqui estas!'
          });
          i++;
        }
      }, 2000);
    };
    return estas.getCerca(scope.ubicacion.coorx, scope.ubicacion.coory).then(function(data) {
      scope.cercanos = data;
      console.log(scope.cercanos.data.length);
      g = parseInt(scope.cercanos.data.length);
      return google.maps.event.addDomListener(window, 'load', scope.initialize());
    });
  };
};

getUser = function(http) {
  var userService;
  userService = {};
  userService.getUser = function() {
    return http({
      method: 'GET',
      url: '/api/user/'
    });
  };
  return userService;
};

getEsta = function(http, window) {
  var estaService;
  estaService = {};
  estaService.getEsta = function(id) {
    return http({
      method: 'GET',
      url: '/api/estacionamiento/' + id
    });
  };
  estaService.getCerca = function(coorx, coory) {
    console.log(coorx);
    return http({
      method: 'POST',
      url: '/api/cercanos',
      data: {
        saludo: 'hola',
        xcoord: coorx,
        ycoord: coory
      }
    });
  };
  return estaService;
};

getEsta.$inject = ['$http', '$window'];

app.factory('service_getEsta', getEsta);

getUser.$inject = ['$http'];

app.factory('service_getUser', getUser);

homeController.$inject = ['$scope', '$window'];

app.controller('homeCtrl', homeController);

userController.$inject = ['$scope', '$window', 'service_getUser', 'service_getEsta'];

app.controller('userCtrl', userController);
